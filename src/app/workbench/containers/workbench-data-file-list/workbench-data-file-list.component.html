<mat-selection-list #dataFileList [multiple]="false" (selectionChange)="onSelectionChange.emit($event.option.value)">
  <ng-container *ngFor="let item of items$ | async">
    <mat-list-option
      [value]="item"
      [selected]="selectedItem && selectedItem.fileId == item.fileId && selectedItem.hduId == item.hduId"
      (dblclick)="onItemDoubleClick.emit({ fileId: item.fileId, hduId: item.hduId })"
      class="expandable"
      (mouseenter)="onMouseEnterNode(item)"
      (mouseleave)="onMouseLeaveNode(item)"
    >
      <div class="item-wrapper" fxLayout="row" fxLayoutAlign="start center" fxFlexFill>
        <div fxFlex="1 1 auto" style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
          <button
            *ngIf="item.children.length > 0"
            mat-icon-button
            [attr.aria-label]="'Toggle ' + item.name"
            (click)="toggleFile($event, item.id)"
            class="small toggle-button"
          >
            <mat-icon class="mat-icon-rtl-mirror">
              {{ !collapsedItems[item.id] ? "expand_more" : "chevron_right" }}
            </mat-icon>
          </button>
          <span [matTooltip]="item.tooltip" [matTooltipShowDelay]="750">{{ item.name }}</span>
        </div>
        <div fxFlex="0 0 60px" class="node-buttons" style="text-align: right" [fxShow]="hoveredItem == item || (hoveredItem == item || item.modified)">
          <button
            [hidden]="hoveredItem != item"
            mat-icon-button
            class="small mr-2"
            aria-label="Save File"
            (click)="saveFile($event, item.fileId)"
            matTooltip="Save File"
            matTooltipShowDelay="500"
          >
            <mat-icon>save</mat-icon>
          </button>
          <button
            [hidden]="hoveredItem != item && !item.modified"
            mat-icon-button
            class="small"
            aria-label="Close File"
            (click)="closeFile($event, item.fileId)"
            matTooltip="Close File"
            matTooltipShowDelay="500"
          >
            <mat-icon>{{ hoveredItem == item || !item.modified ? "clear" : "fiber_manual_record" }}</mat-icon>
          </button>
        </div>
      </div>
    </mat-list-option>
    <ng-container *ngIf="item.children.length > 0 && !collapsedItems[item.id]">
      <mat-list-option
        class="nested"
        *ngFor="let item of item.children; index as i"
        [value]="item"
        [selected]="selectedItem && selectedItem.fileId == item.fileId && selectedItem.hduId == item.hduId"
        (dblclick)="onItemDoubleClick.emit({ fileId: item.fileId, hduId: item.hduId })"
        (mouseenter)="onMouseEnterNode(item)"
        (mouseleave)="onMouseLeaveNode(item)"
      >
        <div class="item-wrapper" fxLayout="row" fxLayoutAlign="start center" fxFlexFill  style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
          <span [matTooltip]="item.tooltip" [matTooltipShowDelay]="750">{{ item.name }}</span>
        </div>
      </mat-list-option>
    </ng-container>
  </ng-container>
</mat-selection-list>

<!-- <mat-table app-cell-focuser #cellFocuser="cellFocuser" #table [dataSource]="dataSource" [trackBy]="trackByFn">

  <ng-container matColumnDef="select">
    <mat-header-cell *matHeaderCellDef class="select-header-cell" app-focusable-cell #cell="cell" [rowIndex]="0" [columnIndex]="0"
      (focus)="cb?.focus()" [cellInTabOrder]="false">
      <mat-checkbox #cb [disabled]="!showSelectAll()" (change)="$event ? masterToggle() : null" [checked]="multiSelectionModel.hasValue() && isAllSelected()"
        [indeterminate]="multiSelectionModel.hasValue() && !isAllSelected()" [tabIndex]="cell.isActiveCell ? 0 : -1">
      </mat-checkbox>
    </mat-header-cell>
    <mat-cell *matCellDef="let row; let rowIndex = index;" app-focusable-cell #cell="cell" [rowIndex]="allowMultiSelection ? rowIndex+1 : rowIndex"
      [columnIndex]="0" (focus)="cb?.focus()" [cellInTabOrder]="primarySelectionModel.isSelected(row)">
      <mat-checkbox #cb (click)="$event.stopPropagation()" (change)="$event ? multiSelectionModel.toggle(row) : null" [checked]="primarySelectionModel.isSelected(row) || multiSelectionModel.isSelected(row)"
        [tabIndex]="cell.isActiveCell ? 0 : -1"  [disabled]="primarySelectionModel.isSelected(row)">
      </mat-checkbox>
    </mat-cell>
  </ng-container>

  <ng-container matColumnDef="name">
    <mat-header-cell *matHeaderCellDef class="select-header-cell" app-focusable-cell [rowIndex]="0" [columnIndex]="allowMultiSelection ? 1 : 0"
      [cellInTabOrder]="true">
      Name
    </mat-header-cell>
    <mat-cell *matCellDef="let row; let rowIndex = index;" app-focusable-cell #cell="cell" [rowIndex]="allowMultiSelection ? rowIndex+1 : rowIndex"
      [columnIndex]="allowMultiSelection ? 1 : 0" [cellInTabOrder]="true" (click)="onRowClick(row)" (keydown.space)="$event.preventDefault();"
      (keyup)="onRowKeyup($event, row);">
      <div class="item-row" [class.selected]="primarySelectionModel.isSelected(row)">
        <div class="valign-center">
          <span class="filename">{{row.name}}</span>
        </div>
      </div>
    </mat-cell>
  </ng-container>


  <mat-header-row [hidden]="!allowMultiSelection" *matHeaderRowDef="['select', 'name']"></mat-header-row>
  
  <mat-row *matRowDef="let row; columns: allowMultiSelection ? ['select', 'name'] : ['name'];"></mat-row>
</mat-table> -->

<!-- <tree-root [nodes]="nodes$ | async" [options]="options"></tree-root> -->

<!-- <div class="tree" style="position: relative">
  <mat-tree [dataSource]="dataSource" [treeControl]="treeControl">
    <mat-tree-node *matTreeNodeDef="let node" matTreeNodeToggle matTreeNodePadding [class.selected]="selectedItem && selectedItem.hduId == node.item.hduId && selectedItem.fileId == node.item.fileId">
      {{node.item.name}}
    </mat-tree-node>

    <mat-tree-node *matTreeNodeDef="let node; when: hasNoContent" matTreeNodePadding>
      {{node.item.name}}
    </mat-tree-node>

    <mat-tree-node *matTreeNodeDef="let node; when: hasChild" matTreeNodePadding [class.selected]="selectedItem && selectedItem.hduId == node.item.hduId && selectedItem.fileId == node.item.fileId">
      <button mat-icon-button matTreeNodeToggle [attr.aria-label]="'Toggle ' + node.name">
        <mat-icon class="mat-icon-rtl-mirror">
          {{ treeControl.isExpanded(node) ? "expand_more" : "chevron_right" }}
        </mat-icon>
        {{node.item.name}}
      </button>
      
    </mat-tree-node>
  </mat-tree> -->

<!-- <tree-root
    #tree
    [focused]="treeFocused"
    [nodes]="nodes$ | async"
    [options]="options"
    [(state)]="state"
    tabindex="0"
    (focus)="onFocus()"
    (blur)="onBlur()"
  >
    <ng-template #treeNodeTemplate let-node let-index="index">
      <div
        class="node-content"
        fxLayout="row"
        fxLayoutAlign="start center"
        fxFlexFill
        (mouseenter)="onMouseEnterNode(node.data)"
        (mouseleave)="onMouseLeaveNode(node.data)"
        
      >
        <div fxFlex="1 1 auto" class="node-text" [matTooltip]="node.data.tooltip" [matTooltipShowDelay]="500">
          <span>
            <mat-icon *ngIf="node.data.icon" aria-hidden="false" aria-label="image icon" class="small">{{ node.data.icon }}</mat-icon>
            <span>{{ node.data.name }}</span>
          </span>
        </div>
        <div *ngIf="node.data.showButtonBar" fxFlex="0 0 80px" class="node-buttons" style="text-align: right">
          <button
            [hidden]="hoverNodeId != node.data.id"
            mat-icon-button
            class="small mr-2"
            aria-label="Save File"
            (click)="saveFile($event, node.data)"
            matTooltip="Save File"
            matTooltipShowDelay="500"
          >
            <mat-icon>save</mat-icon>
          </button>
          <button
            [hidden]="hoverNodeId != node.data.id && !node.data.modified"
            mat-icon-button
            class="small"
            aria-label="Close File"
            (click)="closeFile($event, node.data)"
            matTooltip="Close File"
            matTooltipShowDelay="500"
          >
            <mat-icon>{{ hoverNodeId === node.data.id || !node.data.modified ? "clear" : "fiber_manual_record" }}</mat-icon>
          </button>
        </div>
      </div>
    </ng-template>
  </tree-root> -->
<!-- </div> -->

<!-- 
<mat-table
  app-cell-focuser
  #cellFocuser="cellFocuser"
  #table
  [dataSource]="items"
  [trackBy]="trackByFn"
  class="data-file-list"
>
  
  <ng-container matColumnDef="name">
    <mat-header-cell
      *matHeaderCellDef
      class="select-header-cell"
      app-focusable-cell
      [rowIndex]="0"
      [columnIndex]="0"
      [cellInTabOrder]="true"
    >
      Name
    </mat-header-cell>
    <mat-cell
      *matCellDef="let row; let rowIndex = index"
      app-focusable-cell
      #cell="cell"
      [rowIndex]="rowIndex"
      [columnIndex]="0"
      [cellInTabOrder]="true"
      (click)="onRowClick(row)"
      (dblclick)="onRowDoubleClick(row)"
      (keydown.space)="$event.preventDefault()"
      (mouseenter)="mouseOverFileId = row.id"
      (mouseleave)="mouseOverFileId = null"
    >
      <div
        fxLayout="row"
        fxLayoutAlign="start center"
        fxFlexFill
        class="item-row data-file-list-item"
        [class.selected]="selectedItem?.fileId == row.fileId && selectedItem?.hduId == row.hduId"
      >
        <div fxFlex="1 1 auto">
          <span class="filename" style="user-select: none">
            <ng-container *ngIf="row.type == 'file'">{{row.name}}</ng-container>
            <ng-container *ngIf="row.type == 'hdu'">
              <mat-icon *ngIf="row.hduType == HduType.IMAGE" aria-hidden="false" aria-label="image icon">insert_photo</mat-icon>
              <mat-icon *ngIf="row.hduType == HduType.TABLE" aria-hidden="false" aria-label="table icon">toc</mat-icon>
              {{row.name}}
            </ng-container>
          </span>
        </div>
        <div fxFlex="0 0 60px" style="text-align: right;" *ngIf="row.type == 'file'"> -->
<!-- <button
            [hidden]="mouseOverFileId != row.id || !row.modified"
            mat-icon-button
            class="small mr-2"
            aria-label="Save File"
            (click)="saveFile(row.id)"
            matTooltip="Save File"
            matTooltipShowDelay="500"
          >
            <mat-icon>save</mat-icon>
          </button>
          <button
            [hidden]="mouseOverFileId != row.id && !row.modified"
            mat-icon-button
            class="small"
            aria-label="Close File"
            (click)="closeFile(row.id)"
            matTooltip="Close File"
            matTooltipShowDelay="500"
          >
            <mat-icon>{{
              mouseOverFileId === row.id || !row.modified
                ? "clear"
                : "fiber_manual_record"
            }}</mat-icon>
          </button> -->
<!-- </div>
      </div>
    </mat-cell>
  </ng-container>

  <mat-row *matRowDef="let row; columns: ['name']"></mat-row>
</mat-table> -->
