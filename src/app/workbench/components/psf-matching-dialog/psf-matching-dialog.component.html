<div fxLayout="column" fxLayoutGap="20px" style="height: 100%">
    <div fxFlex="1 1 50px">
        <h2 mat-dialog-title>PSF Matching Tool</h2>
    </div>
    <div fxLayout="column" fxLayoutGap="20px" style="width: 100%; height: 100%">
        <table style="width: 100%;" mat-table [dataSource]="hdus" class="mat-elevation-z8">

            <!--- Note that these columns can be defined in any order.
                  The actual rendered columns are set as a property on the row definition" -->

            <!-- Position Column -->
            <ng-container matColumnDef="order">
                <th mat-header-cell *matHeaderCellDef> Order </th>
                <td mat-cell *matCellDef="let hdu"> {{hdu.order}} </td>
            </ng-container>

            <!-- Name Column -->
            <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef> Name </th>
                <td mat-cell *matCellDef="let hdu"> {{hdu.name}} </td>
            </ng-container>

            <!-- Type Column -->
            <ng-container matColumnDef="type">
                <th mat-header-cell *matHeaderCellDef> Type </th>
                <td mat-cell *matCellDef="let hdu"> {{hdu.type}} </td>
            </ng-container>

            <ng-container matColumnDef="fwhmX">
                <th mat-header-cell *matHeaderCellDef> FWHM X </th>
                <td mat-cell *matCellDef="let hdu"> {{fwhmByHduId[hdu.id]?.fwhmX | number:'1.1-3' || ''}} </td>
            </ng-container>

            <ng-container matColumnDef="fwhmY">
                <th mat-header-cell *matHeaderCellDef> FWHM Y </th>
                <td mat-cell *matCellDef="let hdu"> {{fwhmByHduId[hdu.id]?.fwhmY | number:'1.1-3' || ''}} </td>
            </ng-container>

            <!-- Status Column -->
            <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef> Status </th>
                <td mat-cell *matCellDef="let hdu">
                    <div *ngIf="!extractionIsComplete(); else extractionCompletedBlock" fxLayout="row"
                        fxLayoutGap="10px">
                        <div>{{extractionState[hdu.id]?.message || ''}}</div>
                        <mat-progress-spinner *ngIf="extractionState[hdu.id]?.loading" [mode]="'indeterminate'"
                            [diameter]="15">
                        </mat-progress-spinner>
                    </div>
                    <ng-template #extractionCompletedBlock>
                        <ng-container *ngIf="blurState[hdu.id]; let blurState; else blurButtonBlock">
                            <div fxLayout="row" fxLayoutGap="10px">
                                <div>{{blurState.message || ''}}</div>
                                <mat-progress-spinner *ngIf="blurState.loading" [mode]="'indeterminate'"
                                    [diameter]="15">
                                </mat-progress-spinner>
                            </div>
                        </ng-container>
                        <ng-template #blurButtonBlock>
                            <div fxLayout="row" fxLayoutGap="10px">
                                <button *ngIf="canBlur(hdu)" (click)="blurHdu(hdu)" mat-raised-button i18n>
                                    <mat-icon class="mr-1">blur_on</mat-icon>Blur Layer
                                </button>
                            </div>
                        </ng-template>

                    </ng-template>

                </td>
            </ng-container>



            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
        <p>If the stars in your color composite image do not blend well around their edges it may be due to differences
            in the amount of atmospheric blurring which was present when the components images were captured. Use this
            tool to intentionally blur the images with the smallest FWHMs so that they are uniform.</p>


    </div>


    <div fxFlex="1 1 50px">
        <div fxFlex="1 1 auto" fxLayout="row" style="width: 100%" style="justify-content: flex-end">
            <div fxFlex="0 0 auto" fxLayout="row">
                <button mat-raised-button mat-dialog-close i18n>Close</button>
            </div>
        </div>
    </div>
</div>